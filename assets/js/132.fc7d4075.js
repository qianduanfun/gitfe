(window.webpackJsonp=window.webpackJsonp||[]).push([[132],{532:function(e,n,t){"use strict";t.r(n);var s=t(48),c=Object(s.a)({},(function(){var e=this.$createElement,n=this._self._c||e;return n("ContentSlotsDistributor",{attrs:{"slot-key":this.$parent.slotKey}},[n("h2",{attrs:{id:"_08-微信网页授权"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_08-微信网页授权"}},[this._v("#")]),this._v(" 08.微信网页授权")]),this._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[this._v("<?php\necho '去access文件里面找这个项目';die;\nrequire('conf.php');\nrequire('Curl.php');\nfunction get_curl($url) {\n    $curl = curl_init();\n    curl_setopt($curl, CURLOPT_URL, $url);\n    curl_setopt($curl, CURLOPT_POST, false);\n    curl_setopt($curl, CURLOPT_USERAGENT, 'User-Agent: Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; .NET CLR 2.0.50727; .NET CLR 3.0.04506.648; .NET CLR 3.5.21022)');\n    curl_setopt($curl, CURLOPT_TIMEOUT, 10);\n    curl_setopt($curl, CURLOPT_FOLLOWLOCATION, true);\n    curl_setopt($curl, CURLOPT_RETURNTRANSFER, true);\n    $result = curl_exec($curl);\n    curl_close($curl);\n    return $result;\n}\n\n$code = $_GET['code'];\nif (empty($code)) {\n    echo 'user not permissioned';\n    exit;\n} else {\n    echo $code;\n}\n\n// 第二步：通过code换取网页授权access_token\n// 获取code后，请求以下链接获取access_token：  \n//      https://api.weixin.qq.com/sns/oauth2/access_token?appid=APPID&secret=SECRET&code=CODE&grant_type=authorization_code \n$url = \"https://api.weixin.qq.com/sns/oauth2/access_token?appid={$appid}&secret={$appsecret}&code={$code}&grant_type=authorization_code\";\necho '</br></br>';\n// echo $url;\n\n$cont = Curl::CurlGet($url);\n// $cont = get_curl($url);\n// var_dump($cont);\n$cont = (array)json_decode($cont);\n// var_dump($cont);\n\n// 第四步：拉取用户信息(需scope为 snsapi_userinfo)\n// 如果网页授权作用域为snsapi_userinfo，则此时开发者可以通过access_token和openid拉取用户信息了。\n// 请求方法\n// http：GET（请使用https协议） \n//      https://api.weixin.qq.com/sns/userinfo?access_token=ACCESS_TOKEN&openid=OPENID&lang=zh_CN \n$url = \"https://api.weixin.qq.com/sns/userinfo?access_token={$cont['access_token']}&openid={$cont['openid']}&lang=zh_CN\";\n$cont = Curl::CurlGet($url);\n$user = (array)json_decode($cont);\nvar_dump($user);\n\n")])])])])}),[],!1,null,null,null);n.default=c.exports}}]);