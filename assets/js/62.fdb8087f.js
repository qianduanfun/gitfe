(window.webpackJsonp=window.webpackJsonp||[]).push([[62],{461:function(e,t,n){"use strict";n.r(t);var a=n(48),r=Object(a.a)({},(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[n("h4",{attrs:{id:"koa路由实现"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#koa路由实现"}},[e._v("#")]),e._v(" koa路由实现")]),e._v(" "),n("h5",{attrs:{id:"原生路由实现"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#原生路由实现"}},[e._v("#")]),e._v(" 原生路由实现")]),e._v(" "),n("p",[e._v("实现原生路由，需要得到地址栏输入的路径，然后根据路径的不同进行跳转。\n在koa中，使用ctx.request.url就可以获取到当前页面的路径\neg:")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("  const Koa = require('koa')\n  const app = new Koa()\n\n  app.use( async ( ctx ) => {\n    let url = ctx.request.url\n    ctx.body = url\n  })\n  app.listen(3000)\n")])])]),n("p",[n("img",{attrs:{src:"http://f.shudong.wang/huangxiangyang/20200215143828.png",alt:"20200215143828"}}),e._v("\n原生路由的实现需要引入fs模块来读取文件。然后再根据路由的路径去读取，最后返回给页面，进行渲染。\neg:")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("const Koa = require('koa');\nconst fs = require('fs');\nconst app = new Koa();\n\nfunction render(page){\n    return  new Promise((resolve,reject)=>{\n        let pageUrl = `./page/${page}`;\n        fs.readFile(pageUrl,\"binary\",(err,data)=>{\n            if(err){\n                reject(err)\n            }else{\n                resolve(data);\n            }\n        })\n    })\n}\n\nasync function route(url){\n    let page = '404.html';\n    switch(url){\n        case '/':\n            page ='index.html';\n            break;\n        case '/index':\n            page ='index.html';\n            break;\n        case '/404':\n            page = '404.html';\n            break;\n        default:\n            break; \n    }\n    let html = await render(page);\n    return html;\n}\n\napp.use(async(ctx)=>{\n    let url = ctx.request.url;\n    let html = await route(url);\n\n    ctx.body=html;\n})\napp.listen(3000);\n")])])]),n("h5",{attrs:{id:"koa-router中间件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#koa-router中间件"}},[e._v("#")]),e._v(" Koa-router中间件")]),e._v(" "),n("p",[e._v("安装方法：")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("npm install --save koa-router\n")])])]),n("p",[e._v("安装完成后，我们来试一下基础使用方法：")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("const Koa = require('koa');\n// 引入中间件\nconst Router = require('koa-router');\n\nconst app = new Koa();\nconst router = new Router();\n// 127.0.0.1:3000\nrouter\n    .get('/', (ctx, next)=>{\n        ctx.body = 'hello, koa-router'\n    })\n//路由装载\napp\n    .use(router.routes())\n    .use(router.allowedMethods()); //遵循上文get请求\n\napp.listen(3000, ()=>{\n    console.log('3000')\n})\n")])])]),n("p",[n("img",{attrs:{src:"http://f.shudong.wang/huangxiangyang/20200217142634.png",alt:"20200217142634"}}),e._v("\n多页面配置方法：")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("router.get('/', function (ctx, next) {\n    ctx.body=\"Hello1\";\n})\n.get('/index',(ctx,next)=>{\n    ctx.body=\"hello2\"\n});\n")])])]),n("h5",{attrs:{id:"路由层级"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#路由层级"}},[e._v("#")]),e._v(" 路由层级")]),e._v(" "),n("p",[e._v("工作中我们有时候会碰到需要在整个项目的路径中添加一个整体的路由前缀，比如127.0.0.1:3000/index/a, 127.0.0.1:3000/index/b, index就是我们需要统一添加的层级前缀，也就是说，这个路由的所有请求都是相对于这个前缀的。\n这里，我们需要给Router添加一个prefix属性：")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("const router = new Router({\n    prefix:'/index'\n})\n")])])]),n("p",[e._v("prefix属性设置'/index'，表示我们的访问路径加了一个层级index。\n我们来看一下效果：")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("const router = new Router({\n  prefix: '/index'\n});\n\nrouter\n.get('/', (ctx, next)=>{\n    ctx.body = 'hello, koa-router'\n})\n.get('/a', (ctx, next)=>{\n  ctx.body = 'hello, indexa'\n})\napp\n    .use(router.routes())\n    .use(router.allowedMethods()); //遵循上文get请求\n\napp.listen(3000, ()=>{\n    console.log('3000')\n})\n")])])]),n("p",[n("img",{attrs:{src:"http://f.shudong.wang/huangxiangyang/20200217143704.png",alt:"20200217143704"}}),e._v(" "),n("img",{attrs:{src:"http://f.shudong.wang/huangxiangyang/20200217143717.png",alt:"20200217143717"}})]),e._v(" "),n("p",[e._v("设置前缀一般都是全局的，并不能实现个别路由的层级，如果你想为单个页面设置层级，只要在use时使用路径就可以了。")]),e._v(" "),n("p",[e._v("我们给不同的路由添加层级，首先，声明两个路由，一个是home，一个是page，然后通过use来赋予不同的前层级。")]),e._v(" "),n("p",[e._v("例子：")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("const Koa = require('koa');\nconst app = new Koa();\nconst Router = require('koa-router');\n\nlet home = new Router(); // 子路由home\nhome.get('/a', (ctx)=>{\n    ctx.body = 'Home a';\n}).get('/b', (ctx)=>{\n    ctx.body = 'Home b';\n})\n\nlet page = new Router(); // 子路由page\npage.get('/a', (ctx)=>{\n    ctx.body = 'Page a';\n}).get('/b', (ctx)=>{\n    ctx.body = 'Page b';\n})\n\n//通过父级路由router装载所有子路由\nlet router = new Router();\nrouter.use('/home',home.routes(),home.allowedMethods());\nrouter.use('/page',page.routes(),page.allowedMethods());\n\n//将父级路由router加载到app路由中间件上\napp.use(router.routes()).use(router.allowedMethods());\n\napp.listen(3000,()=>{\n    console.log('3000')\n});\n")])])]),n("p",[n("img",{attrs:{src:"http://f.shudong.wang/huangxiangyang/20200217145633.png",alt:"20200217145633"}}),e._v(" "),n("img",{attrs:{src:"http://f.shudong.wang/huangxiangyang/20200217145654.png",alt:"20200217145654"}})]),e._v(" "),n("h5",{attrs:{id:"路由传递参数"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#路由传递参数"}},[e._v("#")]),e._v(" 路由传递参数")]),e._v(" "),n("p",[e._v("koa中，我们可以通过ctx.query来获取路由中传递的参数。")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("router.get('/', function (ctx, next) {\n    ctx.body=ctx.query;\n});\n")])])]),n("p",[n("img",{attrs:{src:"http://f.shudong.wang/huangxiangyang/20200217155947.png",alt:"20200217155947"}})])])}),[],!1,null,null,null);t.default=r.exports}}]);