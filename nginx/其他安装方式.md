<!-- @import "[TOC]" {cmd="toc" depthFrom=1 depthTo=6 orderedList=false} -->

<!-- code_chunk_output -->

- [其他安装方式](#其他安装方式)
  - [apt-get 安装](#apt-get-安装)
    - [启动](#启动)
    - [停止](#停止)
    - [卸载](#卸载)
    - [验证](#验证)
  - [编译安装](#编译安装)
    - [download](#download)
    - [解压](#解压)
    - [编译](#编译)
    - [参数介绍](#参数介绍)
    - [默认编译](#默认编译)
    - [make 编译](#make-编译)
    - [make install](#make-install)
    - [软连接](#软连接)
    - [启动 nginx](#启动-nginx)

<!-- /code_chunk_output -->

# 其他安装方式

## apt-get 安装

```sh
apt-get update
apt-get install nginx -y
```

### 启动

```sh
nginx
# service nginx start
```

### 停止

```sh
service nginx stop
```

### 卸载

```sh
# 删除除了配置文件以外的所有文件。
sudo apt-get remove nginx nginx-common
# 删除所有与nginx有关的东西，包括配置文件。
sudo apt-get purge nginx nginx-common
# 在上面命令结束后执行，主要是删除与Nginx有关的且不再被使用的依赖包。
sudo apt-get autoremove
# 删除两个主要的包。
sudo apt-get remove nginx-full nginx-common
```

### 验证

```sh
service nginx restart
```

## 编译安装

https://nginx.org/

### download

![B8EF3A6F4BBA9F33](https://n.devland.cn/xiaoranzi/B8EF3A6F4BBA9F33.png)

- Mainline version
  最新的版本
- Stable version
  稳定的版本
- Legacy versions
  历史版本

我们选择稳定的版本: `nginx-1.20.0`

```sh
wget https://nginx.org/download/nginx-1.20.0.tar.gz
```

![3455EB620C2734FB](https://n.devland.cn/xiaoranzi/3455EB620C2734FB.png)

### 解压

```sh
tar -xzf nginx-1.20.0.tar.gz
```

> -x 从压缩文件中还原文件。
>
> -z 通过 gzip 指令处理压缩文件。
>
> -f 指定压缩文件。
>
> 具体可以查看 `tar` 的命令

### 编译

### 参数介绍

```sh
./configure --help | more
```

![2F4F7799D42A0AD0](https://n.devland.cn/xiaoranzi/2F4F7799D42A0AD0.png)
nginx 执行过程中会找哪些目录下的哪些文件，做为他的辅助文件。

如果没有任何变动，只需要指定 `--prefix` 这个参数就行。

![E8A4A8ACAE7FBB14](https://n.devland.cn/xiaoranzi/E8A4A8ACAE7FBB14.png)
在执行过程中表示使用或者不使用哪些文件。一般以 `with` 或者 `without` 开头。

- `with` 开头的模块默认是不会打包进 nginx 中的。

  > 加了代表会被打包进去

- `without` 开头的默认会被编译进 nginx 中的。
  > 加了表示会被移除

![F182F95D3EFCDCFE](https://n.devland.cn/xiaoranzi/F182F95D3EFCDCFE.png)
nginx 编译中需要的一些特殊的参数，比如用到了 gcc 编译时候需要加一些参数、或者需要打印 debug 级别的日志。

### 默认编译

```sh
./configure  --prefix=/home/kaikeba/nginx
```

代表使用的是默认编译，编译到目录 `/home/kaikeba/nginx` 。

![E4C0955335FB4D77](https://n.devland.cn/xiaoranzi/E4C0955335FB4D77.png)

### make 编译

```sh
make
```

如果没有任何错误，就编译完成了，生成了大量的中间文件，并最终生成了可以运行的 nginx 二进制文件。可以在 objs 目录查看。

nginx 的目标文件放在 objs/nginx 这里。

如果我们要对 nginx 进行升级，不能执行 `make install`. 需要在`objs`目录把 nginx 执行文件 copy 到安装目录中。

c 语言编译时生成的所有中间文件，都会放在 `objs/src` 目录。

如果使用动态模块编译，会生成对应的 `.so` 文件也会放在 `objs` 目录下。

### make install

首次安装时候使用这个命令。

安装完毕以后

```sh
cd /home/kaikeba/nginx
```

这里就是之前指定的安装目录。
![2B9832569FA868C5](https://n.devland.cn/xiaoranzi/2B9832569FA868C5.png)

- sbin

  执行文件目录

- conf

  配置文件目录，默认是从之前源码的 conf 目录中 copy 了一份过来

- logs

  日志目录

- html

  默认的网页目录

### 软连接

因为我们 `--prefix` 指定的安装目录不是 `/usr/bin/nginx`，所以需要软连接到执行目录之后才能全局使用。

```sh
ln -s /home/kaikeba/nginx/sbin/nginx /usr/bin
```

### 启动 nginx

```sh
nginx
```
